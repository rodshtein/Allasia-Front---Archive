/* Ellipsis, made by me ðŸ˜œ  https://github.com/zamkevich */
import{tick as Z}from"svelte";const q="position:absolute;left:0;top:-100%; border:none;opacity:0;visibility:hidden;pointer-events:none;transform:translateZ(0)";function E(i,{cutLength:S=0,overflowBadge:v="\u2026",affectNode:o=null,sliceAfter:O=/\p{Letter}/u}={}){let n,t,m=0,d=!0,R=o?o.style.display:null,p=!1,a=new ResizeObserver(W),g=new MutationObserver(M),j=e=>new CustomEvent("update",{detail:e}),B=e=>new CustomEvent("nodeApdated",{detail:e}),r=()=>window.__ellipsis?window.__ellipsis:window.__ellipsis={affectNodes:new Set};function H(){if(window.__ellipsisNodesContainer)return window.__ellipsisNodesContainer;{let e=document.createElement("div");return e.setAttribute("ariaHidden",!0),e.style.cssText=q,document.body.append(e),window.__ellipsisNodesContainer=e,window.__ellipsisNodesContainer}}w();async function w(){await C()?(T(),k(),_()):(f(),N())}function T(){let e=i.cloneNode(!0);e.style.position="unset",typeof t=="object"?(t.before(e),t.remove(),t=e):(t=e,i.before(t),H().append(i),N())}function k(){typeof n=="object"&&n.remove(),n=i.cloneNode(!0),H().append(n)}async function c(e,l){await Z(),i.dispatchEvent(j({type:e,status:l}))}let A=!1;async function D(e){if(!A){u=!0;let l=new Promise(function(s,z){let I=setTimeout(async()=>{r().affectNodes.size===e&&(console.log("true"),clearInterval(I),r().affectNodes.forEach(P=>{P.style.display="none",s()}))},150)})}}async function h(e){e=="hide"&&(r().affectNodes.add(o),await D(r().affectNodes.size).then(()=>{console.log("hidden"),p=!0})),e=="show"&&(o.style.display=R,p=!1)}async function C(){let e;return typeof t=="object"?(e=t,t.textContent=i.textContent):e=i,p&&await h("show"),e.clientHeight<e.scrollHeight?o?(h("hide"),e.clientHeight<e.scrollHeight?(h("show"),c("overflow",!0),!0):(c("overflow",!1),!1)):(c("overflow",!0),!0):(c("overflow",!1),!1)}function L(){return n.textContent="Lg",t.clientHeight>=n.clientHeight}function _(){if(console.log("runned"),L()){let e=t.clientHeight/(t.scrollHeight/100),l=t.style.width;t.style.width="100%",n.style.width=t.clientWidth-1+"px",t.style.width=l,b(Math.round(i.textContent.length/100*e))}else f()}function b(e,l,s=!1){if(s=s||++m,s!=m)return;let z=i.textContent.substr(0,e)+v;n.textContent=z,n.clientHeight>t.clientHeight&&(l==!1?x(--e):setTimeout(()=>b(--e,!0,s),20)),n.clientHeight<=t.clientHeight&&(l==!0?x(e):b(++e,!1,s))}function x(e){for(;!O.test(i.textContent[e-1]);)--e;t.textContent=i.textContent.substr(0,e-S)+v,f()}function N(){g.observe(i,{attributes:!0,characterData:!0,subtree:!0})}function f(){if(!r){let e={};window.Ellipsis=e}d=!0,a.observe(typeof t=="object"?t:i)}let y=!1;function M(){y||(y=!0,setTimeout(()=>{a.disconnect(),w(),y=!1},300))}let u=!1;function W(){d?d=!1:u||(u=!0,setTimeout(async()=>{typeof t=="object"?(a.disconnect(),await C()?_():f()):w(),u=!1},300))}return{update(e){e.affectNode&&(o=e.affectNode)},destroy(){a.disconnect(),g.disconnect()}}}export{E as default};
